\newcommand{\worker}{\emph{Worker}}
\newcommand{\peer}{\emph{Peer}}
\newcommand{\broker}{\emph{Broker}}

\section{Introdução} \label{sec:intro}

O compartilhamento de recursos computacionais através de grids computacionais é útil porque permite que os recursos sejam melhor aproveitados. Tempo ocioso. O investimento é diluído entre domínios administrativos.

Vamos falar agora de computação (vs. armazenamento, rede etc.). Em grids voluntárias [talvez o termo voluntárias não seja bom, confunde com folding@home] não há garantia de que os recursos serão obtidos. Com poucos recursos disponíveis as tarefas podem demorar mais do que o desejado, diminuindo a utilidade do resultado (sistemas de tempo real não crítico - ver função de utilidade).

Por outro lado, existe utility computing, um modelo de negócio em que o usuário obtém recursos rapidamente (rapid provisioning, elastic computing) e paga pelo tempo de uso em um grão pequeno.

Tendo acesso a um provedor de utility computing, um usuário pode optar por gastar dinheiro alugando infra-estrutura a fim de completar suas tarefas em menos tempo. Com os middlewares atuais [cuidado!], o escalonamento de tarefas entre o grid e o provedor de utility deve ser feito pelo usuário.

Este trabalho tem o intuito de avaliar as modificações necessárias em um middleware de grid, o OurGrid \cite{ougrid:unite}, para habilitá-lo a um cenário híbrido, em que dispõe de recursos do grid e do provedor de cloud computing, em particular o Amazon AWS (Amazon Web Services)
(adaptações)

\section{Amazon Web Services} \label{sec:amazon}

O \emph{Amazon Web Services} (AWS) é um conjunto de serviços que conecta diretamente desenvolvedores a plataforma tecnológica da Amazon. O \emph{Amazon Elastic Compute Cloud} (Amazon EC2) é um \emph{Web Service} que provê uma infra-estrutura computacional ajustável na nuvem, que permite o controle dos recursos computacionais, desde a instanciação (ver Tabela \ref{tab:ec2}) ao gerenciamento de capacidades \cite{ec2}. A escalabilidade dessa infra-estrutura está relacionada à virtualização do ambiente computacional. Cada ambiente virtual é representado por uma imagem (\emph{Amazon Machine Image} -- AMI) que pode ser criada pelo desenvolvedor, contendo suas aplicações, bibliotecas, dados e configurações, ou pode ser utilizado uma das imagens pré-configuradas que podem ser utilizadas sem nenhum custo adicional. Todas as imagens são armazenadas no \emph{Amazon Simple Storage Service} (Amazon S3), um serviço de armazenamento para a \emph{Internet}, através de \emph{Web Services}, que provêem armazenamento de volume de dados \cite{s3}.

\small
\begin{table}[ht] \label{tab:ec2}
\caption{Instâncias de servidores Amazon EC2 \cite{ec2}}
\centering
\begin{tabular}{|l c c c c|}
\hline
\multicolumn{1}{|c}{\textbf{Instância}} & \textbf{Memória} & \textbf{Unidades} & \textbf{Armazenamento} & \textbf{Plataforma} \\
 & \textbf{(GB)}& \textbf{Computacionais (GB)} & \textbf{(GB)} & \textbf{(bits)}\\
\hline
\textbf{Standard} & - & - & - & - \\
\qquad Small & 1.7 & 1 (1 núcleo virtual) & 160 & 32 \\
\qquad Large & 7.5 & 4 (2 núcleos virtuais) & 850 & 64 \\
\qquad Extra & 15 & 8 (4 núcleos virtuais) & 1690 & 64 \\

\textbf{High-CPU} & - & - & - & - \\
\qquad Medium & 1.7 & 5 (2 núcleos virtuais) & 350 & 32 \\
\qquad Extra Large & 7 & 20 (8 núcleos virtuais) & 1690 & 64 \\
\hline
\end{tabular}
% tabela
\end{table}

Um usuário inicia as instâncias através de uma interface programática (API), e em poucos minutos a instância se encontra em execução. O encerramento de instâncias é realizado da mesma forma. A princípio, cada usuário pode executar até vinte instâncias de máquinas virtuais ao mesmo tempo, mas o limite máximo pode ser negociado com o provedor. A contabilização do serviço é proporcional ao tempo (quantidade de horas) que uma instância está ativa (arredondando para cima), ou seja, se um usuário utilizar uma instância por meia hora, irá lhe custar o equivalente a uma hora de uso.

%Utilizaremos aqui o Amazon AWS porque é barato, a adesão é fácil (basta dar o número do cartão de crédito) e a documentação é abundante. Nossa solução pode, no entanto, ser aplicada a qualquer serviço similar, como o AppNexus ou ....

%O Amazon possui um serviço denominado EC2 (Elastic Computing/er Cloud) em que o usuário pode executar instâncias de imagens de máquinas virtuais. As imagens são armazenadas no serviço Amazon S3 (Simple Storage Service). Existem imagens públicas armazenadas no S3 que podem ser usadas por qualquer usuário sem custo adicional.

%As instâncias podem ser m1.small, medium, large...

%Um usuário inicia instâncias através de uma interface programática, e em poucos minutos a instância está rodando. O encerramento de instâncias é feito da mesma forma. Cada usuário pode, a princípio, rodar até 20 instâncias de máquinas virtuais, mas o limite máximo pode ser negociado com o provedor.

%O serviço mede o tempo em que cada instância está ativa. O valor cobrado pela execução de uma instância é proporcional à quantidade de horas em que a instância está ativa (arredondado pra cima). 

\section{OurGrid} \label{sec:ourgrid}

O OurGrid é uma grade computacional entre-pares cooperativa, aberta e de fácil implantação, onde os participantes compartilham recursos ociosos de processamento e armazenamento de dados, para a execução de aplicações que possuam tarefas independentes, i.e., aplicações \emph{Bag-of-Tasks (BoT)} \cite{ourgrid:unite}.

A Figura \ref{fig:ourgrid:arquitetura} apresenta a arquitetura do OurGrid com seus quatro componentes principais: o \emph{Broker}, que é uma interface cliente de submissão de tarefas; o \emph{Peer}, entidade que agrupa consumidores e recursos de um domínio, controlando a doação e requisição de máquinas; o \emph{Worker}, recurso executor das tarefas repassadas pelo usuário; e o \emph{Discovery Service}, um serviço de descoberta de recursos disponíveis na grade \cite{ourgrid:portifolio}. A comunicação entre os quatro componentes é realizada através do Commune, um \emph{middleware} que utiliza o protocolo XMPP (\emph{Extensible Messaging and Presence Protocol}) para troca de informações. 
% portifolio = figueiredo 2008

\begin{figure}[ht] \label{fig:ourgrid:arquitetura}
\caption{Arquitetura do OurGrid}
\centering
\includegraphics[width=1\textwidth]{arquitetura_ourgrid}
\end{figure}

O OurGrid possui uma rede de favores (\emph{Network of Favors -- NoF}) \cite{ourgrid:ABCM07}, que é um mecanismo de incentivo para a troca de recursos computacionais que desencoraja \emph{free riding}, através de mecanismos de alocação de recursos baseados na reputação de um \emph{Peer}, ou seja, cada \emph{Peer} contabiliza o consumo e doação de recursos a outros \emph{Peers} da grade. A unicidade de cada \emph{Peer} é garantida através da utilização de autenticação baseada em chave pública, gerada a partir de um par de chaves assimétricas \cite{ourgrid:portifolio}, ou através do uso de certificados no padrão X.509 PKI (\emph{Public Key Infrastructure}) \cite{itut}.
% [ITU-T 2005]

%O OurGrid é um middleware de grid para bag-of-tasks, ou seja, tarefas que podem ser executadas independentemente, sem comunicação entre as tarefas.

%O OurGrid funciona como uma rede de favores para combater free riders.

%Comunicação é feita com XMPP. Cada componente possui um par de chaves

%Arquitetura formada por Broker, Worker, Peer.
%[figura]

\section{Proposta (requisitos)} \label{sec:proposta}

R1 Usar recursos do provedor não deve ser mais difícil do que usar recursos da grade. Usar recursos do provedor e da grade, simultaneamente, deve ser igualmente fácil.
R2 O usuário deve ter controle sobre a execução das instâncias, a fim de ter controle sobre o dinheiro gasto. O objetivo aqui é minimizar o tempo da tarefa sujeito a restrições financeiras. (Outra possibilidade, aqui não abordada, é minimizar o gasto sujeito a restrições de tempo, o que caracterizaria um sistema de tempo real rígido) % rever isso
R3 Uma tarefa em execução deve poder usar instâncias iniciadas após o início da tarefa.

(Naturalmente R2 contradiz R1, porque exige uma intervenção a mais do usuário)

\section{Design e Implementação} \label{sec:design}

Proposta: instâncias no EC2 podem ser compartilhadas com a comunidade durante o tempo restante já pago.

Consideramos o caso em que cada domínio administrativo possui uma conta no EC2 da qual seus usuários usufruem. A solução está no \peer.
Naturalmente, um usuário que queira usar sua própria conta no EC2 pode fazê-lo desde que configure um \peer\ para uso próprio.

\begin{figure}[ht] \label{fig:ourgrid:arquitetura}
\caption{Arquitetura do OurGrid com suporte a Amazon Web Services}
\centering
\includegraphics[width=.72\textwidth]{arquitetura_ourgrid_amazon}
\end{figure}

Consideramos dois cenários de uso na criação de instâncias do EC2. No primeiro cenário, a conta do Amazon EC2 está associada a um domínio administrativo e o pagamento pelo serviço é responsabilidade dos administradores do domínio. Os administradores podem implementar alguma política para controlar o número de instâncias que cada usuário pode criar. Esse cenário faz sentido em grupos de pesquisa ou empresas em que haja uma relação de confiança entre as pessoas.

No segundo cenário, cada usuário que deseje usar o EC2 possui uma conta no serviço e paga pelo seu uso. 

A solução para os dois cenários é a mesma: fazer o Peer ser responsável por criar instâncias no EC2. No segundo cenário, o usuário deve instalar e configurar um Peer para uso próprio.

Foi criada uma AMI contendo um \worker\ do OurGrid. Como esse \worker\ será executado em uma máquina virtual, ele foi configurado para executar as tarefas no sistema operacional (normalmente ele cria uma máquina virtual).

Peer registra que o Broker que solicitou a criação das instâncias tem exclusividade sobre elas.

Ao executar uma instância no EC2, o Peer passa como parâmetro de inicialização da instância a configuração do Worker, composta por seu nome de usuário, senha, o endereço e a chave pública do Peer.

Quantas instâncias são levantadas? Quem controla isso?

Segurança:
O root cria um cron job que desliga a instância após uma hora.
Isso evita que a instância fique executando indefinidamente no caso de a rede local cair.
O Worker EC2 é executado como um usuário posix sem privilégios.

%Broker solicita N instâncias por no máximo H horas (de forma a estabelecer um limite no dinheiro gasto)
%Cada instância possui um Worker.
%Uma das instâncias possui um Peer?
%Broker ganha a habilidade de instanciar Workers diretamente, sem precisar solicitar a um Peer?
%Worker vanilla.
%Ao fim do processamento, o Broker doa a instância para um Peer pelo tempo que resta do crédito já pago?
%
%Configuração: o que um usuário precisa configurar para começar a usar OurGrid + EC2?
%
%-- Considerações
%
%É seguro?
%É eficiente? (financeiramente)
%
%Naturalmente a política de solicitação de recursos que o Broker utiliza será diferente quando um provedor de utility está envolvido. Pode não ser vantajoso solicitar 20 instâncias para usar durante 15 min, já que o valor cobrado dá direito a 1 hora de uso.

\section{Avaliação / Experiência} \label{sec:avaliacao}

Experimentamos com instâncias m1.small.

Tempo até a tarefa terminar = tempo de espera + tempo de execução + tempo de transferência do resultado.

Nossos experimentos avaliaram que o tempo de espera é de, em média, X minutos. Acreditamos que esse tempo pode ser reduzido se criarmos uma instalação de Linux mais enxuta.

Medidas:
- Speedup: Usando X máquinas, gastamos quantas vezes menos tempo? Comparar speedup em rede local e speed up na Amazon.
- Desempenho individual: máquina da Amazon é quantas vezes mais lenta que uma máquina normal?

Tarefas para experimentação:
- Tarefas CPU-intensivas
- Tarefas I/O-intensivas
- Tarefas rede-intensivas

%\section{Trabalhos Relacionados} \label{sec:trabrel}
%
%Hadoop
%% http://wiki.apache.org/hadoop/AmazonEC2
%% http://developer.amazonwebservices.com/connect/entry.jspa?externalID=873
%
%GridGain
%% http://blog.griddynamics.com/2008/07/gridgain-on-ec2.html
%
%Globus Science Cloud
%% http://workspace.globus.org/clouds/
%
\section{Conclusão} \label{sec:conclusao}

Implementar algoritmos de escalonamento que levem em consideração o fator custo financeiro.
Avaliar cenários em que vários Brokers querem compartilhar recursos do provedor de utility (maior utilização do recurso já pago, conta rachada)?
